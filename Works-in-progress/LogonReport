<#Made this for ACA. Willow needs to check logon times for various users/computers periodically over the next few months. 
This way she can do it herself instead of having to call us every time. 
There are definitely better ways to do this, but we're not officially supporting it- just put this together as a favor. 
#>

Function Get-Logons {

[cmdletbinding()]
Param(
[parameter(mandatory=$true)]
$computername,
[parameter(mandatory=$true)]
$username,
[parameter(mandatory=$true)]
$PreviousDays

)
$credential = Get-Credential
$log = get-eventlog security -computername $computername -after (get-date).adddays(-($PreviousDays))
$Logons = $log | ? {$_.eventid -eq 4624 -and $_.replacementstrings[5] -eq "$username"} | select -expandproperty timegenerated
$Logoffs = $Log | ? {$_.eventid -eq "4647"} | select -ExpandProperty timegenerated

$body = "Logons:`n`n"
$logons | % {$body += "$_`n"}
$body += "`nLogoffs:`n`n"
$Logoffs | % {$body += "$_`n"}

send-mailmessage -from $credential.username -to $credential.username -subject "Logon activity" -body "$body" -credential ($credential) -usessl -smtpserver smtp.office365.com -port "587"

}
